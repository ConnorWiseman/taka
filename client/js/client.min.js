"use strict";var taka=taka||function(e){var t=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),n=function(){if("object"==typeof document.currentScript)return document.currentScript;var e=document.getElementById("script");return e[e.length-1]},i=function(e,t){var n=e.parentElement;t instanceof p?n.replaceChild(t.HTMLElement,e):n.replaceChild(t,e)},a=function(e){if(""!==document.cookie)for(var t=document.cookie.split(";"),n=0;n<t.length;n++){for(var i=t[n];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(e+"="))return console.log("get",i.substring((e+"=").length,i.length)),i.substring((e+"=").length,i.length)}return null},s=function(e,t,n,i){if(void 0===n||null===n){var n=new Date;n.setTime(n.getTime()+31536e6),n=n.toUTCString()}if(void 0===i||null===i)var i="/";var a=encodeURI(e)+"="+encodeURI(t)+"; expires="+n+"; path="+i;console.log("set",a),document.cookie=a},o=function(e){var t=new Date(e),n="",i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],a=t.getDate(),s=t.getMonth(),o=t.getHours(),r=t.getMinutes();r=10>r?"0"+r:r;var l=12>o?" AM":" PM";return n=i[s]+" "+a+", "+o+":"+r+l},r=function(e){var t=e>>24&255,n=e>>16&255,i=e>>8&255,a=255&e;return t+"."+n+"."+i+"."+a},l=function(e){if(void 0!==window.io&&null!==window.io)return e();var t=document.createElement("script");t.addEventListener("load",function(){return e()}),t.setAttribute("async","true"),t.setAttribute("src","https://cdn.socket.io/socket.io-1.3.7.js"),document.head.appendChild(t)},d=function(e){var t=document.createElement("span");if(t.classList.add("fa"),"FontAwesome"===window.getComputedStyle(t).fontFamily)return e();var n=document.createElement("link");n.addEventListener("load",function(){return e()}),n.setAttribute("rel","stylesheet"),n.setAttribute("href","https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"),document.head.appendChild(n)},u=function(e){l(function(){d(function(){return e()})})},c=function(){return"admin"===e.role||"mod"===e.role},p=function(e){this.HTMLElement=document.createElement(e),this.append=function(e){return this.HTMLElement.appendChild(e instanceof p?e.HTMLElement:e),this},this.prepend=function(e){return e instanceof p?this.HTMLElement.insertBefore(e.HTMLElement,this.HTMLElement.firstChild):this.HTMLElement.insertBefore(e,this.HTMLElement.firstChild),this},this.removeChild=function(e){return this.HTMLElement.removeChild(e instanceof p?e.HTMLElement:e),this},this.removeChildren=function(){for(;this.HTMLElement.firstChild;)this.removeChild(this.HTMLElement.firstChild);return this},this.appendText=function(e){var t=document.createTextNode(e+"");return this.HTMLElement.appendChild(t),this},this.text=function(e){return this.removeChildren(),this.appendText(e+""),this},this.html=function(e){return this.removeChildren(),this.HTMLElement.innerHTML=e+"",this},this.setAttribute=function(e,t){return this.HTMLElement[e+""]=t+"",this},this.setAttributes=function(e){for(var t in e)this.HTMLElement[t+""]=e[t];return this},this.removeAttribute=function(e){return this.HTMLElement.removeAttribute(e),this},this.data=function(e,t){return this.HTMLElement.dataset[e+""]=t+"",this},this.css=function(e){for(var t in e)this.HTMLElement.style[t+""]=e[t]+"";return this},this.addClass=function(e){return this.HTMLElement.classList.add(e+""),this},this.removeClass=function(e){return this.HTMLElement.classList.remove(e+""),this},this.toggleClass=function(e){return this.HTMLElement.classList.toggle(e+""),this},this.on=function(e,t){return this.HTMLElement.addEventListener(e+"",t),this},this.animateScrollTo=function(e,n){var i=this.HTMLElement.scrollTop,a=0,s=Math.max(.5,Math.min(Math.abs(i-e)/n,1)),o=function(e){return Math.sin(e*(Math.PI/2))},r=function(){a+=1/60;var n=a/s,l=o(n);return 1>n?(this.HTMLElement.scrollTop=i+(e-i)*l,void t(r)):(this.HTMLElement.scrollTop=e,this)}.bind(this);r()}},m=function(){e.protocol="http://",e.host="127.0.0.1",e.path="/chat",e.query="session_id="+a("taka-session_id"),console.log("query",e.query),e.currentScript=n(),e.activeTab=!1;var t=function(){e.activeTab=!e.activeTab};document.addEventListener("focus",function(){t()}),document.addEventListener("blur",function(){t()}),void 0===e.defaultAvatar&&(e.defaultAvatar="http://placehold.it/35x35.png"),void 0===e.audio&&(e.audio={mp3:"../audio/click.mp3",ogg:"../audio/click.ogg"}),void 0===e.animateMessages&&(e.animateMessages=!0),void 0===e.defaultProtocol&&(e.defaultProtocol="http"),e.volume=a("taka-volume")||2;var l=function(e){var t=[0,.5,1];return t[e]},d=function(e){var t=["fa-volume-off","fa-volume-down","fa-volume-up"];return t[e]};u(function(){var t=io(e.protocol+e.host,{path:e.path,query:e.query}),n=new p("div");n.setAttribute("id","taka"),n.css({fontFamily:"sans-serif",fontSize:"12px",height:e.height+"px",position:"relative",width:e.width+"px"});var a=new p("audio");a.setAttributes({preload:"auto",volume:l(e.volume)});var u=new p("source");u.setAttributes({src:e.audio.mp3,type:"audio/mpeg"}),a.append(u);var m=new p("source");m.setAttributes({src:e.audio.ogg,type:"audio/ogg"}),a.append(m),n.append(a);var f=function(){a.setAttribute("volume",l(e.volume)),Et.setAttribute("className","fa "+d(e.volume)),a.HTMLElement.play()},h=function(){a.setAttribute("volume",l(e.volume))},v=new p("div");v.addClass("message-list-wrapper"),v.css({display:"inline-block","float":"left",height:e.height-98+"px",margin:"4px",overflow:"auto",width:e.width-16+"px"}),v.on("scroll",function(){0===v.HTMLElement.scrollTop&&g.HTMLElement.firstElementChild&&t.emit("loadMessages",g.HTMLElement.firstElementChild.id)});var g=new p("div");g.addClass("message-list"),g.css({width:"100%"}),v.append(g),n.append(v);var b=function(t,n,i){if(void 0===n&&(n=!1),void 0===i&&(i=!1),t||n)if(i&&e.activeTab){var a=v.HTMLElement.scrollHeight;v.animateScrollTo(a,2)}else v.HTMLElement.scrollTop=v.HTMLElement.scrollHeight},x=function(e){var t=new p("div");return t.css({backgroundColor:"rgba(255, 0, 0, 0.1)",borderRadius:"2px",clear:"both",margin:"4px",padding:"4px",textAlign:"center",fontSize:"80%"}),t.text(e),t},w=function(t,n){var i=v.HTMLElement.scrollHeight-v.HTMLElement.scrollTop===v.HTMLElement.clientHeight;return g.append(x(t)),b(i,!0,e.animateMessages),n&&"function"==typeof n?n():void 0},M=function(e){var t=new p("div");t.addClass("message"),t.setAttribute("id",e._id),t.css({clear:"both",minHeight:"39px",padding:"4px 4px 0 0",textAlign:"left",wordWrap:"break-word"});var n;return n=void 0!==e.author?e.author:{username:e.guestAuthor},t.data("author",n.username),t.append(T(e)),t.append(L(e)),t.append(E(n)),t.append(k(e)),t},T=function(t){var n,i=new p("img");return n=void 0!==t.author&&void 0!==t.author.avatar&&""!==t.author.avatar?t.author.avatar:e.defaultAvatar,i.addClass("avatar"),i.setAttributes({width:"35",height:"35",src:n}),i.css({"float":"left",margin:"0 4px 4px 0",MozUserSelect:"none",webkitUserSelect:"none",msUserSelect:"none",userSelect:"none"}),i},L=function(e){var n=new p("div");if(n.addClass("information"),n.css({fontSize:"65%",textAlign:"right",MozUserSelect:"none",webkitUserSelect:"none",msUserSelect:"none",userSelect:"none"}),n.appendText(o(e.date)),c()){n.setAttribute("title","IP: "+r(e.ip_address));var i=new p("a");i.addClass("delete-message"),i.addClass("fa"),i.addClass("fa-times"),i.setAttributes({href:"#",title:"Delete message"}),i.css({color:"#aa0000",display:"inline-block",margin:"0 4px",textDecoration:"none"}),i.on("click",function(e){e.preventDefault(),t.emit("deleteMessage",e.target.parentNode.parentNode.id)}),n.append(i)}return n},E=function(e){var t=new p("span");if(t.addClass("author"),void 0!==e.username)if(void 0!==e.URL&&null!==e.URL&&""!==e.URL){var n=new p("a");n.setAttributes({href:e.URL,target:"_blank"}),n.css({textDecoration:"none"}),n.appendText(e.username),t.append(n)}else t.appendText(e.username);else t.appendText(e.guestAuthor);return t.appendText(": "),t},H=function(e){var t=document.createElement("div");return t.textContent=e,t.innerHTML},U=function(e){var t=/(\*\*|__)(.{1,}?)\1(?=\s|<|$)/gi,n=/(\*|_)(.{1,}?)\1(?=\s|<|$)/gi,i=/(\~)(.{1,}?)\1(?=\s|$)/gi;return e=e.replace(t,function(e){return"<b>"+e.trim().substring(2,e.length-2)+"</b>"}),e=e.replace(n,function(e){return"<i>"+e.trim().substring(1,e.length-1)+"</i>"}),e.replace(i,function(e){return"<s>"+e.trim().substring(1,e.length-1)+"</s>"})},y=function(t){var n=/https?:\/\/(?:[a-z0-9\-]+\.)+[a-z]{2,6}(?:\/[^/#?]+)+\.(?:jpg|gif|png)/gi;return t.replace(n,function(t){return'<img src="'+t+'" style="clear: both; display: block; margin: 16px auto; max-height: '+(e.height-140)+"px; max-width: "+(e.width-40)+'px;" />'})},A=function(e){var t=/(?:[^"])(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,}))\.?)(?::\d{2,5})?(?:[/?#]\S*)?/gi;return e.replace(t,function(e){return'<a href="'+e+'" target="_blank">'+e+"</a> "})},k=function(e){var t=new p("span");t.addClass("content");var n=H(e.message);return n=U(n),n=y(n),n=A(n),t.html(n),t},C=function(e,t){return g.append(M(e)),t&&"function"==typeof t?t():void 0},S=function(t,n,i){var a=v.HTMLElement.scrollHeight-v.HTMLElement.scrollTop===v.HTMLElement.clientHeight;return g.append(M(t)),b(a,n,e.animateMessages),i&&"function"==typeof i?i():void 0},z=function(e,t){{var n=M(e);v.HTMLElement.scrollHeight-v.HTMLElement.scrollTop===v.HTMLElement.clientHeight}return g.prepend(n),v.HTMLElement.scrollTop+=n.HTMLElement.clientHeight,t&&"function"==typeof t?t():void 0},D=new p("form");D.css({display:"block",margin:"0 8px 4px"}),n.append(D);var R=new p("textarea");R.setAttributes({placeholder:"Type your message here...",disabled:"true"}),R.css({boxSizing:"border-box",fontFamily:"inherit",fontSize:"inherit",height:"56px",padding:"4px",resize:"none",width:e.width-16+"px"}),D.append(R);var N=new Event("submit",{bubbles:!0,cancelable:!0}),P=function(e){return"Enter"===e.key||13===e.keyCode};R.on("keyup",function(e){P(e)&&D.HTMLElement.dispatchEvent(N)}),R.on("keydown",function(e){P(e)&&e.preventDefault()});var I=function(){R.removeAttribute("disabled")},O=function(){R.setAttribute("disabled","true")},_=function(){R.HTMLElement.value=""},F=function(){R.HTMLElement.focus()},Y=function(){return""!==R.HTMLElement.value},j=function(e,t){var i=new p("div");i.addClass("popup-window-title"),i.css({backgroundColor:"#212121",color:"#fafafa",cursor:"move",fontWeight:"bold",padding:"8px",MozUserSelect:"none",webkitUserSelect:"none",msUserSelect:"none",userSelect:"none"}),i.text(e);var a=new p("a");return a.setAttribute("href","#"),a.addClass("fa"),a.addClass("fa-times"),a.css({color:"#aa0000","float":"right",left:"2px",padding:"4px",position:"relative",textDecoration:"none",top:"-4px"}),a.on("click",function(e){e.preventDefault(),t.hide()}),i.append(a),i.on("mousedown",function(){t.beingDragged=!0,n.append(t),t.position.x=t.mousePosition.x-t.HTMLElement.offsetLeft,t.position.y=t.mousePosition.y-t.HTMLElement.offsetTop}),i},q=function(e,t,n){var i=new p("div");i.isVisible=!1,i.beingDragged=!1,document.addEventListener("mouseup",function(){i.beingDragged=!1}),i.position={x:0,y:0},i.mousePosition={x:0,y:0},document.addEventListener("mousemove",function(e){i.mousePosition.x=e.clientX,i.mousePosition.y=e.clientY;var t=+i.HTMLElement.style.width.split("px")[0],n=+i.HTMLElement.style.height.split("px")[0];i.beingDragged&&(i.css({left:i.mousePosition.x-i.position.x+t/2+"px",top:i.mousePosition.y-i.position.y+n/2+"px"}),i.mousePosition.y-24<0&&i.css({top:n/2+"px"}),i.mousePosition.x-t/2-24<0&&i.css({left:t/2+"px"}),i.mousePosition.y+n>document.documentElement.clientHeight&&i.css({top:document.documentElement.clientHeight-n/2-16+"px"}),i.mousePosition.x+t>document.documentElement.clientWidth&&i.css({left:document.documentElement.clientWidth-t/2-16+"px"}))});var a=j(e,i);return i.title=a,i.append(a),i.addClass("popup-window"),i.css({backgroundColor:"#ffffff",borderRadius:"2px",boxShadow:"rgba(0, 0, 0, 0.7) 0 0 5px",height:n+"px",left:"50%",margin:"-"+n/2+"px 0 0 -"+t/2+"px",opacity:"0",overflow:"hidden",position:"absolute",top:"50%",transition:"opacity 0.15s ease-in",width:t+"px",zIndex:"-2",MozUserSelect:"none",webkitUserSelect:"none",msUserSelect:"none",userSelect:"none"}),i.show=function(){this.css({opacity:"1",zIndex:"2"}),this.isVisible=!0,this.HTMLElement.parentNode.appendChild(this.HTMLElement)},i.hide=function(){this.css({opacity:"0"}),setTimeout(function(){this.css({zIndex:"-2"}),this.isVisible=!1}.bind(this),350)},document.addEventListener("keyup",function(e){27===e.keyCode&&i.hide()}),i},J=function(e){e=e.replace(/^\s*\//,"");for(var t,n=/^ *(?:(?!")([^ ]+)|"((?:[^\\"]|\\[\\"])*)")/,i=[];null!==(t=e.match(n));)i.push(void 0!==t[1]?t[1]:t[2].replace(/\\([\\"])/g,"$1")),e=e.substring(t[0].length);return/^ *$/.test(e)&&i.length?i:null},V=function(){console.log("help"),_(),I()},W=function(e){if(!isNaN(e))return e;e=e.toLowerCase();var t={y:31536e3,d:86400,h:3600,m:60,s:1},n=0;for(var i in t){var a=RegExp("\\d+"+i),s=e.match(a);null!==s&&(n+=+s[0].replace(i,"")*t[i])}return n},B=function(e){return c()?(void 0!==e[1]?(void 0===e[2]?e.push(void 0):e[2]=W(e[2]),void 0===e[3]?e.push(void 0):e[3]=e.splice(3).join(" "),t.emit("banUsername",{username:e[1],duration:e[2],reason:e[3]})):w('/ban <username> <duration> "<reason>"'),_(),void I()):(w("You are not authorized to perform this action."),_(),void I())},$=function(e){return c()?(void 0!==e[1]?t.emit("unbanUsername",e[1]):w("/unban <username>"),_(),void I()):(w("You are not authorized to perform this action."),_(),void I())},X=q("Clear chat history",160,148),G=new p("form");G.css({padding:"8px"}),G.on("submit",function(e){e.preventDefault()}),X.title.on("click",function(){_(),I()});var K=new p("p");K.css({margin:"0 0 12px",padding:"0"}),K.text("This will clear the entire chat history. Continue?"),G.append(K);var Q=new p("div");Q.css({margin:"0 auto",width:"140px;"});var Z=new p("button"),et=new p("button");Z.css({boxSizing:"border-box",display:"inline-block",padding:"2px",margin:"0",textAlign:"center",width:"70px"}),Z.text("Clear it!"),Z.on("click",function(){t.emit("clearChat"),_(),I(),X.hide()}),et.css({boxSizing:"border-box",display:"inline-block",padding:"2px",margin:"0",textAlign:"center",width:"70px"}),et.text("Wait..."),et.on("click",function(){_(),I(),X.hide()}),Q.append(Z),Q.append(et),G.append(Q),X.append(G),n.append(X);var tt=function(){return c()?void X.show():(w("You are not authorized to perform this action."),_(),void I())},nt=function(e){return c()?(void 0!==e[1]?t.emit("promoteUsername",e[1]):w("/promote <username>"),_(),void I()):(w("You are not authorized to perform this action."),_(),void I())},it=function(e){return c()?(void 0!==e[1]?t.emit("demoteUsername",e[1]):w("/demote <username>"),_(),void I()):(w("You are not authorized to perform this action."),_(),void I())};D.on("submit",function(e){if(e.preventDefault(),Y()){var n=R.HTMLElement.value;if(O(),"/"===n[0]){var i=J(n);switch(i[0]){case"?":case"help":V();break;case"ban":B(i);break;case"unban":$(i);break;case"clear":tt();break;case"promote":nt(i);break;case"demote":it(i);break;default:t.emit("sendMessage",n)}return}t.emit("sendMessage",n)}});var at=q("Sign In / Register",160,148),st=new p("form");st.on("submit",function(e){e.preventDefault()}),st.css({padding:"8px"});var ot=new p("input");ot.css({boxSizing:"border-box",display:"block",padding:"4px",margin:"0 auto 8px",width:"140px"}),ot.setAttribute("placeholder","Username"),st.append(ot);var rt=new p("input");rt.css({boxSizing:"border-box",display:"block",padding:"4px",margin:"0 auto 8px",width:"140px"}),rt.setAttributes({placeholder:"Password",type:"password"}),st.append(rt);var lt=new p("div"),dt=new p("button"),ut=new p("button");lt.css({margin:"0 auto",width:"140px"}),dt.css({boxSizing:"border-box",display:"inline-block",padding:"2px",margin:"0",textAlign:"center",width:"68px"}),dt.text("Sign In"),dt.on("click",function(e){e.preventDefault(),t.emit("signInAttempt",{username:ot.HTMLElement.value,password:rt.HTMLElement.value})}),lt.append(dt),ut.css({boxSizing:"border-box",display:"inline-block",padding:"2px",margin:"0 0 0 4px",textAlign:"center",width:"68px"}),ut.text("Register"),ut.on("click",function(e){e.preventDefault(),t.emit("registerUser",{username:ot.HTMLElement.value,password:rt.HTMLElement.value})}),lt.append(ut),st.append(lt),at.append(st),n.append(at);var ct=q("Online Users",160,248),pt=new p("ul");pt.css({margin:"8px",padding:"0"}),ct.append(pt),n.append(ct);var mt=q("User Settings",160,148),ft=new p("form");ft.on("submit",function(e){e.preventDefault()}),ft.css({padding:"8px"});var ht=new p("input");ht.css({boxSizing:"border-box",display:"block",padding:"4px",margin:"0 auto 8px",width:"140px"}),ht.setAttribute("placeholder","Avatar"),ft.append(ht);var vt=new p("input");vt.css({boxSizing:"border-box",display:"block",padding:"4px",margin:"0 auto 8px",width:"140px"}),vt.setAttribute("placeholder","URL"),ft.append(vt);var gt=new p("button");gt.css({boxSizing:"border-box",display:"inline-block",padding:"2px",margin:"0",textAlign:"center",width:"140px"}),gt.text("Update"),gt.on("click",function(e){e.preventDefault();var n=bt(ht),i=bt(vt);n&&i?(ht.css({boxShadow:"none"}),vt.css({boxShadow:"none"}),t.emit("updateSettings",{avatar:ht.HTMLElement.value,URL:vt.HTMLElement.value})):(n||(ht.css({boxShadow:"0 0 3px 1px #aa0000"}),w("Invalid avatar URL.")),i||(vt.css({boxShadow:"0 0 3px 1px #aa0000"}),w("Invalid URL.")))}),ft.append(gt),mt.append(ft);var bt=function(e){var t=RegExp(/(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,}))\.?)(?::\d{2,5})?(?:[/?#]\S*)?/gi);return t.test(e.HTMLElement.value)||""===e.HTMLElement.value};n.append(mt);var xt=new p("div");xt.css({clear:"both",margin:"0 8px",MozUserSelect:"none",webkitUserSelect:"none",msUserSelect:"none",userSelect:"none"});var wt=new p("a"),Mt=new p("span"),Tt=new p("span");wt.setAttributes({href:"#",title:"Online users"}),wt.css({"float":"left",textDecoration:"none"}),wt.on("click",function(e){e.preventDefault(),ct.isVisible?ct.hide():ct.show()}),Mt.addClass("fa"),Mt.addClass("fa-users"),Tt.css({margin:"0 0 0 4px"}),wt.append(Mt),wt.append(Tt),xt.append(wt);var Lt=new p("div");Lt.css({"float":"right"});var Et=new p("a");Et.setAttributes({href:"#",title:"Adjust volume"}),Et.addClass("fa"),Et.addClass(d(e.volume)),Et.css({margin:"0 4px 0 0",textAlign:"center",textDecoration:"none",width:"12px"}),Et.on("click",function(t){t.preventDefault(),e.volume--,e.volume<0&&(e.volume=2),s("taka-volume",e.volume),h(),Ht(),f()}),Lt.append(Et);var Ht=function(){Et.setAttribute("className","fa "+d(e.volume))},Ut=new p("a");Ut.setAttributes({href:"#",title:"Settings"}),Ut.addClass("fa"),Ut.addClass("fa-cog"),Ut.css({display:"none",margin:"0 4px 0 0",textDecoration:"none"}),Ut.on("click",function(e){e.preventDefault(),mt.isVisible?mt.hide():mt.show()}),Lt.append(Ut);var yt=new p("a");yt.setAttribute("href","#"),yt.addClass("fa"),yt.css({textDecoration:"none"}),yt.on("click",function(n){n.preventDefault(),"guest"===e.role?at.isVisible?at.hide():at.show():(mt.hide(),t.emit("signOut"))}),Lt.append(yt),xt.append(Lt);var At=function(e){var t=new Date(e),n="",i=["January","February","March","April","May","June","July","August","September","October","November","December"],a=t.getDate(),s=t.getMonth(),o=t.getFullYear(),r=t.getHours(),l=t.getMinutes()+1;l=10>l?"0"+l:l;var d=12>r?" AM":" PM";return r=r>12?r-12:r,n=r+":"+l+d+" on "+i[s]+" "+a+", "+o},kt=function(t){s("taka-session_id",t.id),e.role=t.role,"guest"===e.role?(yt.setAttribute("title","Sign in / register"),yt.removeClass("fa-user-times"),yt.addClass("fa-user-plus"),Ut.css({display:"none"})):(yt.setAttribute("title","Sign out"),yt.removeClass("fa-user-plus"),yt.addClass("fa-user-times"),Ut.css({display:"inline-block"}),ht.HTMLElement.value=void 0===t.avatar?"":t.avatar,vt.HTMLElement.value=void 0===t.URL?"":t.URL),ot.setAttribute("value",""),rt.setAttribute("value","")},Ct=function(){pt.removeChildren();for(var n,i=Object.keys(e.onlineUsers).sort(),a=0,s=i.length;s>a;a++){n=i[a];var o=new p("li");o.css({listStyle:"none",margin:"0 0 2px 0"});var r=e.onlineUsers[n].avatar;(void 0===r||""===r)&&(r=e.defaultAvatar);var l=new p("img");l.setAttributes({height:"16",src:r,width:"16"}),l.css({margin:"0 4px -2px 0",position:"relative",top:"2px"}),o.append(l);var d=e.onlineUsers[n].URL,u=n,m=e.onlineUsers[n].instances.length;if(m>1&&(u=n+" ("+m+")"),void 0!==d&&""!==d){var f=new p("a");f.setAttributes({href:d,target:"_blank"}),f.css({textDecoration:"none"}),f.text(u),o.append(f)}else o.appendText(u);if(c()){var h=new p("a");h.addClass("fa"),h.addClass("fa-ban"),h.setAttributes({href:"#",title:"Ban this user"}),h.HTMLElement.dataset.username=n,h.css({color:"#aa0000","float":"right",position:"relative",textDecoration:"none",top:"2px"}),h.on("click",function(e){e.preventDefault(),t.emit("banUsername",{username:this.dataset.username})}),o.append(h)}pt.append(o)}Tt.text(Object.keys(e.onlineUsers).length)},St={errorNotice:function(e){switch(e){case"0":w("That username is unavailable.");break;case"1":w("No such user exists.");break;case"2":w("Username/password mismatch.");break;case"3":w("You can't ban an admin!");break;case"4":w("Unable to ban nonexistent user.");break;case"5":w("If you continue to spam, you will be banned.");break;default:w("An unspecified error has occurred.")}},banNotice:function(e){at.hide(),mt.hide(),ct.hide(),xt.css({display:"none"}),g.removeChildren();var n=new p("div");n.css({margin:"50% auto 0",textAlign:"center"});var i=new p("div"),a="";"ip"===e.type&&(a+="IP "),i.text("You have been "+a+"banned for the following reason: "),n.append(i);var s=new p("div");s.css({fontWeight:"bold",margin:"1em auto"}),s.text(e.reason),n.append(s);var o=new p("div");o.text("Your ban will expire at "+At(e.expires)+"."),n.append(o),g.append(n),O(),t.disconnect()},sessionStart:function(e){kt(e),I(),n.append(xt)},sessionUpdate:function(n){var i=e.role;kt(n);var a=e.role;if("guest"===i&&"mod"===a||"guest"===i&&"admin"===a)g.removeChildren(),t.emit("loadMessages");else if("mod"===i||"admin"===i)for(var s=g.HTMLElement.children,o=0,r=s.length;r>o;o++){var l=s[o].children;l[1].removeAttribute("title"),l[1].removeChild(l[1].lastElementChild)}at.hide()},settingsUpdate:function(t){for(var n=document.querySelectorAll('[data-author="'+t.username+'"]'),i=0,a=n.length;a>i;i++){n[i].firstChild.src=""!==t.avatar?t.avatar:e.defaultAvatar;var s=n[i].firstChild.nextSibling.nextSibling,o=E(t);n[i].replaceChild(o.HTMLElement,s)}e.onlineUsers[t.username].avatar=""!==t.avatar?t.avatar:e.defaultAvatar,""!==t.URL?e.onlineUsers[t.username].URL=t.URL:delete e.onlineUsers[t.username].URL,mt.hide(),Ct()},onlineUsers:function(t){e.onlineUsers=t,Ct()},onlineUsersAdd:function(t){void 0===e.onlineUsers[t.username]&&(e.onlineUsers[t.username]={joined:t.joined,instances:[]}),e.onlineUsers[t.username].avatar=t.avatar,e.onlineUsers[t.username].URL=t.URL,e.onlineUsers[t.username].instances.push(t.instance),Ct()},onlineUsersRemove:function(t){var n=e.onlineUsers[t.username].instances.indexOf(t.instance);n>-1&&e.onlineUsers[t.username].instances.splice(n,1),0===e.onlineUsers[t.username].instances.length&&delete e.onlineUsers[t.username],Ct()},onlineUsersRename:function(t){if(t.oldName!==t.newName){if(e.onlineUsers.hasOwnProperty(t.newName)){for(var n=0,i=e.onlineUsers[t.oldName].instances.length;i>n;n++)e.onlineUsers[t.newName].instances.push(e.onlineUsers[t.oldName].instances[n]);delete e.onlineUsers[t.oldName]}e.onlineUsers.hasOwnProperty(t.oldName)&&(e.onlineUsers[t.newName]=e.onlineUsers[t.oldName],delete e.onlineUsers[t.oldName]),e.onlineUsers[t.newName].avatar=t.avatar,e.onlineUsers[t.newName].URL=t.URL,Ct()}},initialMessages:function(e){e=e.reverse();for(var t=0,n=e.length;n>t;t++)C(e[t]);v.HTMLElement.scrollTop=v.HTMLElement.scrollHeight},additionalMessages:function(e){for(var t=0,n=e.length;n>t;t++)z(e[t])},newMessage:function(e){S(e),f()},confirmMessage:function(e){S(e,!0),I(),_(),F()},deleteMessage:function(e){g.removeChild(document.getElementById(e))},clearChat:function(){g.removeChildren()}};i(e.currentScript,n);for(var zt in St)t.on(zt+"",St[zt])})};return new m};